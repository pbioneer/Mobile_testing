# Charles Proxy 

**Charles Proxy** — это мощный инструмент для анализа и отладки сетевого трафика, который помогает разработчикам и тестировщикам.

##  Установка и настройка Charles Proxy

### Установка:
1. Скачать Charles Proxy с [официального сайта](https://www.charlesproxy.com/)
2. Установить на ПК 

### Настройка сертификата:
**На компьютере:**
1. Открыть Charles Proxy 
1. В верхнем меню Charles выбрать Help > SSL Proxying > Install Charles Root Certificate
3. Добавить сертификат в доверенные 

**На Android:**
1. Подключить телефон к той же сети, что и ПК
2. В настройках Wi-Fi указать ручной прокси с IP ПК и портом 8888
3. Открыть `chls.pro/ssl` в браузере, скачал и установил сертификат или в верхнем меню Charles выбрать Help > SSL Proxying > Save Charles Root Certificate - скачать сертификат и перекинуть его на телефон любым доступным способом. 
4. В настройках сертификатов отметить его как доверенный

**На iOS:**
1. Открыть `chls.pro/ssl` в браузере
2. В Settings → Profile установить сертификат
3. В About → Certificate Trust Settings включить доверие


##  Функциональности Charles Proxy

1. **Фильтрация запросов**
   
Позволяет фильтровать входящие и исходящие запросы по различным критериям (например, типу файлов, домену, статус-коду и др.). Позволяет выбирать, какие именно запросы будут отображаться в логах. Помогает сосредоточиться именно на тех запросах, которые важны для анализа.

Самое примитивное - скопировать хост и вставить в поле "Filter". Так будут видны только запросы с этого хоста. Примерно того же результата можно добиться, если в контекстном меню выбрать "Focus". Остальные запросы будут собраны в "Other Hosts". Если при этом перейти на закладку "Sequence" и отметить настройку "Focused", то в списке окажется информация только о тех запросах, которые были выбраны на вкладке "Structure". 

Charles Proxy умеет работать с регулярными выражениями. Для этого на вкладке "Sequence" нужно выбраеть "Settings" и отметить пункт "Filter uses regex". Вписать в поле поиска элементарную регулярку.
Например: ```^\w{4}\.```  выберет все запросы, в которых в начале имени хоста находится четыре буквы, а потом идет точка.

2. **Работа с логами**
   
Отображает историю всех сетевых запросов и ответов, делая удобным просмотр и анализ взаимодействия клиента с сервером. Помогает искать проблемы, анализировать производительность и отлаживать приложение. Позволяет экспортировать журналы запросов в удобочитаемом виде, упрощает повторное использование предыдущих запросов.

4. **Работа с зашифрованным трафиком (SSL/TLS)**
   
Поддерживает расшифровку SSL/TLS-трафика, передаваемого по защищённым протоколам (HTTPS), позволяя перехватывать и анализировать защищённые HTTPS-запросы. Особенно полезно при исследовании поведения приложений, использующих шифрование.

Чтобы включить SSL proxying для нужного хоста в самом Charles Proxy можно через контекстное меню конкретного хоста. Чтобы не включать каждый хост, можно зайти в "Proxy" > "SSL Proxying settings" и на первой вкладке "SSL Proxying" включить "Enable SSL Proxying".

Аналогично настройке фильтров на вкладках "Include" и "Exclude" можно добавить или исключить конкретные хосты. Если списки на этих вкладках не заполнять, по умолчанию Charles Proxy будет читать трафик со всех хостов.

4. **Map Remote**
   
Эта функциональность позволяет переадресовывать запросы с заданного URL на альтернативный ресурс. Например, можно перенаправлять запросы к локальному серверу разработки вместо реального удалённого сервера, облегчая тестирование изменений на продакшен-сервере, например, при тестировании новых серверов или изменении API-интерфейсов.
Например, можно подменить контура, посылать запрос на dev-контур, но ответ получать с тестового стенда. Для этого нужно создать новый пункт в списке "Map Remote Settings". "Map From" - куда изначально был запрос,  "Map to" - откуда берем ответ.


6. **Breakpoints**
   
Позволяют временно остановить выполнение конкретного запроса, давая возможность детально проанализировать заголовки, тело запроса или отклика перед отправкой/получением и возможность изменения данных. Полезно для тестирования сценариев взаимодействия клиента и сервера. Очень удобен при поиске ошибок и проверке правильности данных.

Установить Breakpoint можно из контекстного меню запроса. После этого все аналогичные запросы будут перехвачены. Их можно будет просматривать и редактировать. 
Чтобы проверить, как это работает можно использовать повтор запроса "Repeat" из того же контекстного меню. Запрос перехватывается, его можно редактировать.
Изменить можно все - от "header" до авторизационного токена. Когда редактирование будет закончено, можно выбрать "Execute" и в Charles Proxy появится повторный запрос, который и отправится на сервер, а потом вернется с ответом. В этот момент можно посмотреть и отредактировать ответ, который получит приложение - появится поле "Edit response".

6. **Rewrite**
   
Помогает изменять любые части HTTP-запросов и ответов прямо на лету. Можно менять заголовки, куки, тела запросов и ответов, позволяя тестировать различные сценарии поведения приложений, например, моделировать ситуацию, когда сервер возвращает некорректные данные или изменять данные запроса для проверки реакции приложения.

Rewrite удобно использовать, когда нужен готовый ответ, но ставить брейкпоинт и вписывать его в ручную слишком долго. Редактируя таким образом ответ, фактически,  ставится заглушка - можно имитировать работу сторонних партнеров.

7. **Throttling**
   
Позволяет эмулировать условия медленного интернета или ограниченной пропускной способности сети. Используется для тестирования производительности приложения в условиях низкой скорости интернета, нестабильной сети или плохом качестве соединений.




